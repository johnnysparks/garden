# 04 — Diagnosis System

## Design Intent

Diagnosis is where the educational payload delivers. It should feel like detective work — observing symptoms, considering context, forming a hypothesis, testing it. NOT a multiple choice quiz. The player builds real pattern recognition by seeing visual symptoms in context, making guesses, and living with the consequences.

## When Diagnosis Triggers

A plant with `stress > 0.3` OR any `active_conditions` shows visual distress:

- Leaf color changes (overlays on the SVG)
- Wilting (droop parameter increases)
- Spots, lesions (overlay shapes)
- Growth stalling (no visible size change between weeks)
- High-frequency tremor animation (stress vibration)

These are visible during the free PLAN phase. The player notices something is wrong for free. **Determining what** costs energy.

## Inspection Flow

### Step 1: Zoom In (free)

Player taps/long-presses a distressed plant. Camera zooms to a detail view showing:

- The plant at close range with visible symptoms
- Current week, recent weather summary
- Adjacent plants visible at frame edges

No labels. No diagnosis hints. Just the visual information.

### Step 2: Examine (1 energy)

Player spends an action to examine. The UI shifts to **diagnosis mode:**

Left panel: Close-up of the affected area (leaf detail, stem detail, root zone — player can swipe between views)

Right panel: **Observation notes** — generated from the symptom state:

- “Lower leaves showing dark concentric ring patterns”
- “Yellowing between leaf veins, veins remain green”
- “White powdery coating on upper leaf surfaces”
- “Small water-soaked spot at base of green fruit”

These descriptions use real horticultural language. Repeated exposure to phrases like “interveinal chlorosis” or “concentric lesions” builds vocabulary naturally.

Below notes: **Context clues**

- Soil pH and moisture (if player has unlocked soil testing)
- Recent weather (last 3 weeks summarized)
- Adjacent plants and their health status
- “This species is in the ___ family” (hints at family-wide vulnerabilities)

### Step 3: Hypothesize (free — part of the examine action)

Player sees 3-5 possible diagnoses presented as **hypothesis cards.** Each card shows:

- Condition name (e.g., “Early Blight”)
- One-line description
- Confidence indicator (how well symptoms match)

The key design choice: **the confidence indicator is not always right.** Early-stage symptoms of different conditions can look similar. Iron chlorosis and manganese deficiency both cause interveinal yellowing. The game doesn’t lie, but it shows genuine diagnostic ambiguity.

Hypotheses are generated by matching current symptoms against all conditions in the plant’s vulnerability list + a few red herrings from related conditions.

```
hypothesis_pool = []
for each vulnerability V in species.vulnerabilities:
  match_score = compare_symptoms(plant.active_symptoms, V.symptoms.current_stage)
  if match_score > 0.2:
    hypothesis_pool.push({condition: V, confidence: match_score})

// Add 1-2 plausible wrong answers from same symptom family
for each condition C in SIMILAR_CONDITIONS[best_match.symptom_type]:
  hypothesis_pool.push({condition: C, confidence: partial_match_score})

// Sort by confidence, show top 3-5
```

### Step 4: Select Hypothesis (free — part of examine)

Player picks one. This is logged in the field journal as:

```
Week 14: Examined Cherokee Purple Tomato at [2,3]
Observed: Dark concentric ring patterns on lower leaves
Diagnosed as: Early Blight (Alternaria solani)
[Correct / Incorrect — revealed after treatment outcome]
```

### Step 5: Treat (separate INTERVENE action, 1 energy)

Based on the diagnosis, the player chooses a treatment:

- Remove affected leaves (prune)
- Apply fungicide (copper-based, neem, etc.)
- Adjust watering
- Amend soil
- Do nothing and monitor
- Pull the plant

**Correct diagnosis + correct treatment** → condition stabilizes or reverses
**Correct diagnosis + wrong treatment** → condition continues, wasted action
**Wrong diagnosis + any treatment** → no effect or worsens (e.g., diagnosing fungal infection as nutrient deficiency and fertilizing → feeding the pathogen)

The feedback loop is delayed by 1-2 weeks — you don’t know if your treatment worked immediately. This mirrors reality and creates tension.

## Learning Reinforcement

### Field Journal

Every diagnosis (right or wrong) gets a journal entry. When confirmed correct:

- Full encyclopedia entry unlocks for that condition
- Real photo reference (stretch goal)
- Prevention tips
- Common confusion pairs (“Often confused with manganese deficiency — check soil pH to differentiate”)

Wrong diagnoses are also logged: “Diagnosed as iron chlorosis — later identified as manganese deficiency.” The journal becomes a record of the player’s learning arc.

### Pattern Libraries

After correctly diagnosing a condition 3 times across different runs:

- Player unlocks a “Quick ID” ability — the confidence indicator becomes more accurate for that condition
- Visual: a small badge appears on the hypothesis card
- This represents real expertise — experienced gardeners can spot early blight at a glance

### Diagnostic Difficulty Curve

Early game (Zone 8, beginner plants):

- Symptoms are distinctive and unambiguous
- Hypothesis pools are small (2-3 options)
- Feedback is fast (1 week)
- Conditions progress slowly

Late game (Zone 5, advanced plants):

- Multiple simultaneous conditions on one plant
- Ambiguous symptom overlap
- Delayed feedback
- Fast progression requiring quick intervention

## Condition Database (Starter Set)

### Fungal

|Condition           |Key Visual                            |Common Plants           |Often Confused With  |
|--------------------|--------------------------------------|------------------------|---------------------|
|Powdery Mildew      |White powder on leaf surfaces         |Squash, cucumber, peas  |Downy mildew         |
|Downy Mildew        |Yellow patches above, gray fuzz below |Lettuce, spinach, basil |Powdery mildew       |
|Early Blight        |Concentric ring spots (target pattern)|Tomato, potato, pepper  |Late blight, septoria|
|Late Blight         |Water-soaked patches, white mold      |Tomato, potato          |Early blight         |
|Botrytis (Gray Mold)|Gray fuzzy mold on fruit/flowers      |Strawberry, tomato, bean|Normal overripening  |

### Nutrient Deficiency

|Condition            |Key Visual                                    |Distinguishing Detail               |
|---------------------|----------------------------------------------|------------------------------------|
|Nitrogen deficiency  |Overall yellowing, starting from oldest leaves|Uniform yellowing, not between veins|
|Iron chlorosis       |Interveinal yellowing on NEW leaves           |Young leaves affected first         |
|Manganese deficiency |Interveinal yellowing on NEW leaves           |Nearly identical to iron — check pH |
|Phosphorus deficiency|Purple/reddish tint on leaves                 |Color, not yellowing                |
|Potassium deficiency |Brown leaf edges (scorch)                     |Starts at margins, works inward     |
|Calcium deficiency   |Blossom end rot on fruit                      |Affects fruit, not leaves           |

### Pest

|Pest             |Key Visual                               |Target           |Counter                            |
|-----------------|-----------------------------------------|-----------------|-----------------------------------|
|Aphids           |Clusters of small insects, sticky residue|Nearly everything|Ladybugs, companion planting, spray|
|Tomato hornworm  |Large caterpillar, defoliation           |Solanaceae       |Hand-picking, parasitic wasps      |
|Squash vine borer|Sawdust-like frass at stem base          |Cucurbits        |Row cover, stem wrapping           |
|Cabbage worm     |Green caterpillar, holes in leaves       |Brassicaceae     |Bt spray, row cover                |

### Abiotic

|Condition       |Key Visual                         |Cause                 |
|----------------|-----------------------------------|----------------------|
|Sunscald        |White/tan papery patches on fruit  |Sudden sun exposure   |
|Bolting         |Sudden flower stalk from leafy crop|Heat/day length stress|
|Blossom drop    |Flowers fall without setting fruit |Temperature extremes  |
|Transplant shock|Wilting despite adequate water     |Root disturbance      |

## UI Layout — Diagnosis Mode

```
┌─────────────────────────────────────────────┐
│  ← Back to Garden          Week 14 / Zone 8 │
├───────────────────────┬─────────────────────┤
│                       │ OBSERVATIONS         │
│                       │                      │
│   [Close-up SVG       │ • Dark concentric    │
│    of affected        │   ring patterns on   │
│    plant area]        │   lower leaves       │
│                       │ • Leaves yellowing   │
│   ← leaf | stem | →   │   around spots       │
│     root | fruit      │                      │
│                       │ CONTEXT              │
│                       │ pH: 6.4 | Moist: 0.6 │
│                       │ Last 3wk: humid, warm│
│                       │ Adjacent: basil, bean │
├───────────────────────┴─────────────────────┤
│  YOUR DIAGNOSIS:                             │
│                                              │
│  [Early Blight    ] [Septoria Leaf ] [N Def ]│
│  [●●●●○ confidence] [●●○○○        ] [●○○○○ ]│
│                                              │
│  [ Confirm Diagnosis ]                       │
└─────────────────────────────────────────────┘
```

## Open Questions

- **Should misdiagnosis have a visible “wrong” indicator, or should the player infer from treatment failure?** Leaning toward inference — more realistic, more educational. The journal eventually marks it with hindsight.
- **Soil testing unlock:** should pH/nutrients be hidden by default and require a meta-progression unlock? This adds a nice “leveling up your toolkit” feel and teaches that soil testing is a real skill investment gardeners make.
- **Photo references:** Using real photos for confirmed conditions would massively boost learning transfer to real gardens. Licensing/generation strategy needed.